// Generated by CoffeeScript 1.6.3
(function() {
  (function($, window) {
    return (function(io) {
      var appendTodo, socket;
      appendTodo = function(id, content) {
        var el;
        content = $('<div/>').text(content).html();
        el = $('<tr></tr>');
        el.attr('data-todo-id', id);
        el.append($('<td></td>').html("" + content + " <div class=\"pull-right\"><a href=\"#\" data-todo-id=\"" + id + "\" class=\"delete-todo glyphicon glyphicon-trash\"></span></div>"));
        return $('#todos tbody').append(el);
      };
      socket = io.connect();
      return socket.on('connect', function() {
        socket.get('/todo', function(response) {
          var todo, _i, _len, _ref, _results;
          if (response.err != null) {
            $('#error').html('Oh no! An unknown error occurred.').slideDown();
            return console.log(response.err);
          } else {
            _ref = response.todos;
            _results = [];
            for (_i = 0, _len = _ref.length; _i < _len; _i++) {
              todo = _ref[_i];
              _results.push((function(todo) {
                return appendTodo(todo.id, todo.content);
              })(todo));
            }
            return _results;
          }
        });
        $('#newTodoItem').on('submit', function(e) {
          var content;
          e.preventDefault();
          $('#error').slideUp().html('');
          content = $('#newTodoItemContent').val();
          if (content) {
            return socket.post('/todo', {
              content: content
            }, function(response) {
              if (response.err != null) {
                if (response.err.ValidationError == null) {
                  $('#error').html('Oh no! An unknown error occurred.').slideDown();
                  return console.log(response.err);
                } else {
                  return $('#error').html(response.err.ValidationError.content[0].message).slideDown();
                }
              } else {
                $('#newTodoItemContent').val('');
                return appendTodo(response.todo.id, response.todo.content);
              }
            });
          }
        });
        return $('#todos tbody').delegate('a.delete-todo', 'click', function(e) {
          var id;
          e.preventDefault();
          id = $(this).data('todo-id');
          socket["delete"]("/todo/{#id}", function(response) {
            return console.log(response);
          });
          return false;
        });
      });
    })(window.io);
  })(jQuery, window);

}).call(this);
